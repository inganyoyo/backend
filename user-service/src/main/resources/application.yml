server:
  port: 8001
  servlet:
    encoding:
      charset: UTF-8
      enabled: true
      force: true
      force-request: true
      force-response: true

spring:
  application:
    name: user-service
  
  # Jackson ì„¤ì • (UTF-8 ë° í•œê¸€ ì²˜ë¦¬)
  jackson:
    default-property-inclusion: non_null
    serialization:
      write-dates-as-timestamps: false
      write-dates-with-zone-id: false
      write-durations-as-timestamps: false
    deserialization:
      fail-on-unknown-properties: false
    date-format: "yyyy-MM-dd HH:mm:ss"
    time-zone: Asia/Seoul
    locale: ko_KR
  
  # ë©”ì‹œì§€ ì†ŒìŠ¤ ì¸ì½”ë”©
  messages:
    encoding: UTF-8
  
  # Redis ì„¤ì • (ì„±ëŠ¥ ìµœì í™”)
  redis:
    host: localhost
    port: 6379
    timeout: 5000ms                 # 3000ms â†’ 5000msë¡œ ì¦ê°€ (ë„¤íŠ¸ì›Œí¬ ì§€ì—° ëŒ€ì‘)
    lettuce:
      pool:
        max-active: 20              # 8 â†’ 20ìœ¼ë¡œ ì¦ê°€ (ë™ì‹œ ì—°ê²° ìˆ˜ ì¦ê°€)
        max-wait: 2000ms            # -1ms â†’ 2000msë¡œ ì„¤ì • (ëŒ€ê¸° ì‹œê°„ ì œí•œ)
        max-idle: 10                # 8 â†’ 10ìœ¼ë¡œ ì¦ê°€ (ìœ íœ´ ì—°ê²° ì¦ê°€)
        min-idle: 2                 # 0 â†’ 2ë¡œ ì„¤ì • (ë¯¸ë¦¬ ì—°ê²° ìœ ì§€)
      shutdown-timeout: 200ms       # ì¶”ê°€: Graceful Shutdown
  
  # Session ì„¤ì •
  session:
    store-type: redis
    redis:
      flush-mode: on_save
      namespace: spring:session
    timeout: 1800 # 30ë¶„
  
  # Cache ì„¤ì • (ì„±ëŠ¥ ìµœì í™”)
  cache:
    type: caffeine
    caffeine:
      spec: maximumSize=5000,expireAfterWrite=10m,expireAfterAccess=5m  # ì„±ëŠ¥ í–¥ìƒëœ ì„¤ì •


# Actuator ì„¤ì •
management:
  endpoints:
    web:
      exposure:
        include: health, info, refresh
  endpoint:
    health:
      show-details: always

# ë¡œê¹… ì„¤ì •
logging:
  level:
    org.egovframe.cloud.userservice: info
    org.springframework.security: info
    org.springframework.scheduling: info  # ë¹„ë™ê¸° ì²˜ë¦¬ ë¡œê·¸ ì¶”ê°€
    root: INFO

# ê¶Œí•œ ì„¤ì • (ê¶Œí•œ ìƒì† ì§€ì›)
# ìƒì† ê´€ê³„: SYSTEM_ADMIN â† ADMIN â† USER â† ANONYMOUS
permissions:
  # ğŸ†• ìµëª… ì‚¬ìš©ì (ë¹„ë¡œê·¸ì¸) ê¶Œí•œ - ê¸°ë³¸ ê¶Œí•œ
  ANONYMOUS:
    # ğŸ†• Auth APIë“¤ (auth-serviceì—ì„œ ì œê³µ)
    - service: "auth-service"
      method: "POST"
      path: "/api/v1/auth/login"
      description: "ë¡œê·¸ì¸ API"
    - service: "auth-service"
      method: "POST"
      path: "/api/v1/auth/logout"
      description: "ë¡œê·¸ì•„ì›ƒ API"
    - service: "auth-service"
      method: "GET"
      path: "/api/v1/auth/validate"
      description: "ì„¸ì…˜ ê²€ì¦ API (Gatewayìš©)"
    - service: "auth-service"
      method: "GET"
      path: "/api/v1/auth/check"
      description: "ê¶Œí•œ ì²´í¬ API (Gatewayìš©)"
    - service: "auth-service"
      method: "GET"
      path: "/api/v1/auth/validate"
      description: "ì„¸ì…˜ ê²€ì¦"
  # ë¡œê·¸ì¸ ì‚¬ìš©ì ê¶Œí•œ - ANONYMOUS ê¶Œí•œì„ ìë™ ìƒì†ë°›ìŒ
  USER:
    - service: "auth-service"
      method: "GET"
      path: "/api/v1/auth/validate-and-authorize"
      description: "ì¸ì¦ ë° ê¶Œí•œ ê²€ì¦"
    - service: "user-service"
      method: "GET"
      path: "/api/v1/users/profile"
      description: "ì‚¬ìš©ì í”„ë¡œí•„ ì¡°íšŒ"
    - service: "user-service"
      method: "PUT"
      path: "/api/v1/users/profile"
      description: "ì‚¬ìš©ì í”„ë¡œí•„ ìˆ˜ì •"
    - service: "board-service"
      method: "GET"
      path: "/api/v1/boards/**"
      description: "ëª¨ë“  ê²Œì‹œíŒ ì¡°íšŒ (ê³µê°œ + ë¹„ê³µê°œ)"
    - service: "board-service"
      method: "POST"
      path: "/api/v1/boards/*/posts"
      description: "ê²Œì‹œê¸€ ì‘ì„±"
    - service: "user-service"
      method: "GET"
      path: "/api/v1/test"
      description: "í…ŒìŠ¤íŠ¸ API í˜¸ì¶œ"

  # ê´€ë¦¬ì ê¶Œí•œ - USER ê¶Œí•œì„ ìë™ ìƒì†ë°›ìŒ
  ADMIN:
    - service: "*"
      method: "GET"
      path: "/api/v1/**"
      description: "ëª¨ë“  GET ìš”ì²­"
    - service: "*"
      method: "POST"
      path: "/api/v1/**"
      description: "ëª¨ë“  POST ìš”ì²­"
    - service: "*"
      method: "PUT"
      path: "/api/v1/**"
      description: "ëª¨ë“  PUT ìš”ì²­"
    - service: "*"
      method: "DELETE"
      path: "/api/v1/**"
      description: "ëª¨ë“  DELETE ìš”ì²­"

  # ì‹œìŠ¤í…œ ê´€ë¦¬ì ê¶Œí•œ - ADMIN ê¶Œí•œì„ ìë™ ìƒì†ë°›ìŒ
  SYSTEM_ADMIN:
    - service: "*"
      method: "*"
      path: "/**"
      description: "ì‹œìŠ¤í…œ ì „ì²´ ê¶Œí•œ"
